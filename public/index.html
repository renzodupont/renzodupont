<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Renzo Dupont - Blog de tecnología, desarrollo web, programación y análisis técnico en español para Uruguay y la región."
    />
    <meta
      name="keywords"
      content="tecnología, desarrollo web, programación, Uruguay, español, JavaScript, Python, React, Node.js"
    />
    <meta name="author" content="Renzo Dupont" />
    <title>Renzo Dupont | Tecnología y Desarrollo</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!-- HEADER Y NAVEGACIÓN -->
    <header>
      <div class="container">
        <div class="header-content">
          <a href="/" class="logo">Renzo Dupont</a>

          <!-- SEARCH BAR -->
          <div class="search-container">
            <form class="search-form" onsubmit="performSearch(event)">
              <input
                type="text"
                id="searchInput"
                placeholder="Buscar artículos..."
                class="search-input"
              />
              <button type="submit" class="search-btn">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="21 21l-4.35-4.35"></path>
                </svg>
              </button>
            </form>
          </div>

          <nav>
            <ul>
              <li><a href="/">Inicio</a></li>
              <li><a href="/quienes-somos.html">Sobre Mí</a></li>
              <li><a href="/contacto.html">Contacto</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <!-- HERO SECTION -->
    <section class="hero">
      <canvas id="particleCanvas" class="particle-canvas"></canvas>
      <div class="container">
        <h1>Tecnología en Español.<br />Conocimiento sin Barreras.</h1>
        <p>
          Artículos técnicos, tutoriales y análisis sobre desarrollo web,
          programación y tecnología moderna para la comunidad hispanohablante.
        </p>
      </div>
    </section>

    <!-- FEATURED ARTICLES -->
    <section class="featured-section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Artículos Destacados</h2>
          <div class="featured-controls">
            <button id="featuredPrev" class="control-btn" aria-label="Anterior">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <span id="featuredCounter" class="counter">1 / 3</span>
            <button
              id="featuredNext"
              class="control-btn"
              aria-label="Siguiente"
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </div>
        <div id="featuredArticles" class="featured-grid">
          <!-- Featured articles will be loaded here -->
          <div class="loading">Cargando artículos destacados...</div>
        </div>
      </div>
    </section>

    <!-- SEARCH RESULTS (Hidden by default) -->
    <section class="search-results" id="searchResults" style="display: none">
      <div class="container">
        <h2 class="section-title">
          Resultados de búsqueda para: <span id="searchTerm"></span>
        </h2>
        <div id="searchArticles" class="articles-grid">
          <!-- Search results will be loaded here -->
        </div>
        <button onclick="clearSearch()" class="clear-search-btn">
          Ver todos los artículos
        </button>
      </div>
    </section>

    <!-- ALL ARTICLES -->
    <section class="articles-section" id="allArticles">
      <div class="container">
        <h2 class="section-title">Todos los Artículos</h2>
        <div id="articlesGrid" class="articles-grid">
          <!-- All articles will be loaded here -->
          <div class="loading">Cargando artículos...</div>
        </div>
        <div
          class="pagination-controls"
          id="paginationControls"
          style="display: none"
        >
          <button id="loadMore" class="load-more-btn">
            Cargar más artículos
          </button>
          <div class="pagination-info">
            <span id="paginationInfo"
              >Mostrando <strong id="postsShown">0</strong> de
              <strong id="totalPosts">0</strong> artículos</span
            >
          </div>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Renzo Dupont</h3>
            <p>
              Compartiendo conocimiento sobre tecnología, desarrollo web y
              programación en español para Uruguay y toda la comunidad
              hispanohablante.
            </p>
          </div>
          <div class="footer-section">
            <h3>Enlaces</h3>
            <ul>
              <li><a href="/">Inicio</a></li>
              <li><a href="/quienes-somos.html">Sobre Mí</a></li>
              <li><a href="/contacto.html">Contacto</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Categorías</h3>
            <ul id="categoriesList">
              <!-- Categories will be loaded dynamically -->
            </ul>
          </div>
          <div class="footer-section">
            <h3>Sígueme</h3>
            <div class="social-links">
              <a
                href="https://www.threads.net/@startupp.ai"
                target="_blank"
                rel="noopener"
                aria-label="Threads"
                title="Threads"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M12.186 3.094c-1.967 0-3.554.568-4.708 1.687-1.095 1.061-1.694 2.53-1.78 4.366l2.012.15c.065-1.396.505-2.435 1.302-3.087.84-.687 2.056-1.036 3.619-1.036 1.607 0 2.833.361 3.644 1.073.855.75 1.288 1.86 1.288 3.297 0 .876-.167 1.606-.496 2.17-.33.564-.767.993-1.297 1.274-.53.28-1.124.469-1.771.563-.647.094-1.276.141-1.873.141h-.453v2.002h.453c.706 0 1.424.052 2.137.154.713.103 1.363.281 1.932.529.569.247 1.032.584 1.375 1.003.343.42.515.958.515 1.601 0 1.525-.464 2.686-1.378 3.454-.915.768-2.225 1.156-3.898 1.156-1.705 0-3.003-.362-3.86-1.075-.857-.714-1.344-1.774-1.448-3.153l-2.012.15c.13 1.85.798 3.282 1.983 4.256 1.185.974 2.82 1.466 4.867 1.466 2.145 0 3.847-.521 5.059-1.546 1.213-1.024 1.827-2.452 1.827-4.242 0-.975-.212-1.801-.631-2.457-.42-.656-.97-1.184-1.637-1.571.542-.387.995-.843 1.348-1.357.353-.514.53-1.187.53-2.003 0-1.762-.571-3.163-1.697-4.165-1.125-1.002-2.73-1.507-4.774-1.507z"
                  />
                </svg>
              </a>
              <a
                href="https://www.linkedin.com/in/renzo-dupont-b9797941/"
                target="_blank"
                rel="noopener"
                aria-label="LinkedIn"
                title="LinkedIn"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"
                  />
                </svg>
              </a>
              <a
                href="https://www.tiktok.com/@renzodupont"
                target="_blank"
                rel="noopener"
                aria-label="TikTok"
                title="TikTok"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M16.6 5.82s.51.5 0 0A4.278 4.278 0 0 1 15.54 3h-3.09v12.4a2.592 2.592 0 0 1-2.59 2.5c-1.42 0-2.6-1.16-2.6-2.6 0-1.72 1.66-3.01 3.37-2.48V9.66c-3.45-.46-6.47 2.22-6.47 5.64 0 3.33 2.76 5.7 5.69 5.7 3.14 0 5.69-2.55 5.69-5.7V9.01a7.35 7.35 0 0 0 4.3 1.38V7.3s-1.88.09-3.24-1.48z"
                  />
                </svg>
              </a>
              <a
                href="https://bsky.app/profile/renzodupont.bsky.social"
                target="_blank"
                rel="noopener"
                aria-label="Bluesky"
                title="Bluesky"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8z"
                  />
                </svg>
              </a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Renzo Dupont. Todos los derechos reservados.</p>
        </div>
      </div>
    </footer>

    <!-- JAVASCRIPT -->
    <script>
      let allPosts = [];
      let currentSearch = "";
      let featuredPosts = [];
      let currentFeaturedIndex = 0;
      let currentPage = 1;
      let totalPosts = 0;
      let hasMorePosts = true;
      const postsPerPage = 12;
      let autoPlayInterval = null;
      const autoPlayDelay = 5000; // 5 segundos

      // Load posts on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadFeaturedPosts();
        loadAllPosts();
        loadCategories();
        setupPaginationListeners();
      });

      // Setup pagination event listeners
      function setupPaginationListeners() {
        document
          .getElementById("featuredPrev")
          ?.addEventListener("click", () => {
            stopAutoPlay();
            showPreviousFeatured();
            startAutoPlay();
          });
        document
          .getElementById("featuredNext")
          ?.addEventListener("click", () => {
            stopAutoPlay();
            showNextFeatured();
            startAutoPlay();
          });
        document
          .getElementById("loadMore")
          ?.addEventListener("click", loadMorePosts);
      }

      // Auto-play functions
      function startAutoPlay() {
        if (featuredPosts.length <= 1) return;

        stopAutoPlay(); // Clear any existing interval
        autoPlayInterval = setInterval(() => {
          showNextFeatured();
        }, autoPlayDelay);
      }

      function stopAutoPlay() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
      }

      // Pause auto-play when user hovers over featured section
      document.addEventListener("DOMContentLoaded", function () {
        const featuredSection = document.querySelector(".featured-section");
        if (featuredSection) {
          featuredSection.addEventListener("mouseenter", stopAutoPlay);
          featuredSection.addEventListener("mouseleave", startAutoPlay);
        }
      });

      // Load featured posts
      async function loadFeaturedPosts() {
        try {
          const response = await fetch("/api/posts?featured=true&limit=100");
          const data = await response.json();
          featuredPosts = data.posts;

          if (featuredPosts.length === 0) {
            document.getElementById("featuredArticles").innerHTML =
              "<p>No hay artículos destacados disponibles.</p>";
            document.querySelector(".featured-controls").style.display = "none";
            return;
          }

          // Show first featured post
          currentFeaturedIndex = 0;
          displayFeaturedPosts();
          updateFeaturedControls();

          // Start auto-play if there are multiple featured posts
          if (featuredPosts.length > 1) {
            startAutoPlay();
          }
        } catch (error) {
          console.error("Error loading featured posts:", error);
          document.getElementById("featuredArticles").innerHTML =
            "<p>Error cargando artículos destacados.</p>";
        }
      }

      // Display current featured posts
      function displayFeaturedPosts() {
        const container = document.getElementById("featuredArticles");
        // Show only 1 featured post at a time
        const postsToShow = featuredPosts.slice(
          currentFeaturedIndex,
          currentFeaturedIndex + 1
        );

        container.innerHTML = postsToShow
          .map(
            (post) => `
          <article class="featured-card">
            <div class="featured-image">
              <img src="${getImagePath(post.id)}" alt="${
              post.title
            }" loading="lazy" />
            </div>
            <div class="featured-content">
              <div class="featured-label">Destacado</div>
              <h3><a href="${getPostUrl(post.link)}">${post.title}</a></h3>
              <p class="featured-excerpt">${post.excerpt}</p>
              <div class="featured-meta">
                <time>${formatDate(post.date)}</time>
                <div class="tags">
                  ${post.tags
                    .slice(0, 3)
                    .map((tag) => `<span class="tag">${tag}</span>`)
                    .join("")}
                </div>
              </div>
            </div>
          </article>
        `
          )
          .join("");
      }

      // Navigate featured posts
      function showNextFeatured() {
        if (currentFeaturedIndex + 1 < featuredPosts.length) {
          currentFeaturedIndex += 1;
        } else {
          // Loop back to the beginning
          currentFeaturedIndex = 0;
        }
        displayFeaturedPosts();
        updateFeaturedControls();
      }

      function showPreviousFeatured() {
        if (currentFeaturedIndex > 0) {
          currentFeaturedIndex -= 1;
        } else {
          // Loop to the end
          currentFeaturedIndex = featuredPosts.length - 1;
        }
        displayFeaturedPosts();
        updateFeaturedControls();
      }

      function updateFeaturedControls() {
        const prevBtn = document.getElementById("featuredPrev");
        const nextBtn = document.getElementById("featuredNext");
        const counter = document.getElementById("featuredCounter");

        const currentNumber = currentFeaturedIndex + 1;
        const totalFeatured = featuredPosts.length;

        counter.textContent = `${currentNumber} / ${totalFeatured}`;

        // Never disable buttons since we loop
        prevBtn.disabled = false;
        nextBtn.disabled = false;
        prevBtn.style.opacity = "1";
        nextBtn.style.opacity = "1";
      }

      // Load all posts with pagination
      async function loadAllPosts(append = false) {
        try {
          const response = await fetch(
            `/api/posts?limit=${postsPerPage}&page=${currentPage}`
          );
          const data = await response.json();

          if (append) {
            allPosts = [...allPosts, ...data.posts];
          } else {
            allPosts = data.posts;
          }

          totalPosts = data.pagination.total;
          hasMorePosts = data.pagination.hasMore;

          displayPosts(allPosts, "articlesGrid");
          updatePaginationInfo();
        } catch (error) {
          console.error("Error loading posts:", error);
          document.getElementById("articlesGrid").innerHTML =
            "<p>Error cargando artículos.</p>";
        }
      }

      // Load more posts
      function loadMorePosts() {
        currentPage++;
        loadAllPosts(true);
      }

      // Update pagination info
      function updatePaginationInfo() {
        const controls = document.getElementById("paginationControls");
        const loadMoreBtn = document.getElementById("loadMore");
        const postsShown = document.getElementById("postsShown");
        const totalPostsEl = document.getElementById("totalPosts");

        postsShown.textContent = allPosts.length;
        totalPostsEl.textContent = totalPosts;

        if (hasMorePosts) {
          controls.style.display = "flex";
          loadMoreBtn.style.display = "block";
        } else {
          loadMoreBtn.style.display = "none";
          if (allPosts.length > 0) {
            controls.style.display = "flex";
          }
        }
      }

      // Display posts in a container
      function displayPosts(posts, containerId) {
        const container = document.getElementById(containerId);

        if (posts.length === 0) {
          container.innerHTML = "<p>No se encontraron artículos.</p>";
          return;
        }

        container.innerHTML = posts
          .map(
            (post) => `
          <article class="article-card">
            <div class="article-image">
              <img src="${getImagePath(post.id)}" alt="${
              post.title
            }" loading="lazy" />
            </div>
            <div class="article-content">
              <h3><a href="${getPostUrl(post.link)}">${post.title}</a></h3>
              <p class="article-excerpt">${truncateText(post.excerpt, 120)}</p>
              <div class="article-meta">
                <time>${formatDate(post.date)}</time>
                <div class="tags">
                  ${post.tags
                    .slice(0, 3)
                    .map((tag) => `<span class="tag">${tag}</span>`)
                    .join("")}
                </div>
              </div>
            </div>
          </article>
        `
          )
          .join("");
      }

      // Search functionality
      async function performSearch(event) {
        event.preventDefault();

        const searchTerm = document.getElementById("searchInput").value.trim();
        if (!searchTerm) return;

        currentSearch = searchTerm;

        try {
          const response = await fetch(
            `/api/posts?search=${encodeURIComponent(searchTerm)}&limit=50`
          );
          const data = await response.json();

          document.getElementById("searchTerm").textContent = searchTerm;
          document.getElementById("searchResults").style.display = "block";
          document.getElementById("allArticles").style.display = "none";

          displayPosts(data.posts, "searchArticles");

          // Scroll to results
          document
            .getElementById("searchResults")
            .scrollIntoView({ behavior: "smooth" });
        } catch (error) {
          console.error("Error searching posts:", error);
          document.getElementById("searchArticles").innerHTML =
            "<p>Error en la búsqueda. Inténtelo de nuevo.</p>";
        }
      }

      // Clear search
      function clearSearch() {
        currentSearch = "";
        document.getElementById("searchInput").value = "";
        document.getElementById("searchResults").style.display = "none";
        document.getElementById("allArticles").style.display = "block";
      }

      // Load categories for footer
      function loadCategories() {
        if (allPosts.length === 0) {
          setTimeout(loadCategories, 1000);
          return;
        }

        const allTags = allPosts.flatMap((post) => post.tags);
        const uniqueTags = [...new Set(allTags)];
        const topTags = uniqueTags.slice(0, 6);

        const container = document.getElementById("categoriesList");
        container.innerHTML = topTags
          .map(
            (tag) =>
              `<li><a href="#" onclick="searchByTag('${tag}')">${tag}</a></li>`
          )
          .join("");
      }

      // Search by tag
      function searchByTag(tag) {
        document.getElementById("searchInput").value = tag;
        performSearch({ preventDefault: () => {} });
      }

      // Helper functions
      function getImagePath(postId) {
        return `/posts/2025/10/${postId}-1.png`;
      }

      function getPostUrl(link) {
        return "/" + link.replace("public/", "");
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("es-ES", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function truncateText(text, maxLength) {
        if (text.length <= maxLength) return text;
        return text.substring(0, maxLength).trim() + "...";
      }
    </script>

    <!-- Particle Animation Script -->
    <script>
      // Optimized Particle System for Mobile
      (function () {
        const canvas = document.getElementById("particleCanvas");
        if (!canvas) return;

        const ctx = canvas.getContext("2d", { alpha: true });
        let particles = [];
        let animationFrame;
        let isReducedMotion = window.matchMedia(
          "(prefers-reduced-motion: reduce)"
        ).matches;

        // Detectar si es móvil o tablet
        const isMobile =
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          );
        const isLowPerformance = isMobile || navigator.hardwareConcurrency <= 4;

        // Configuración adaptativa según el dispositivo
        const config = {
          particleCount: isLowPerformance ? 30 : 60,
          particleSpeed: isLowPerformance ? 0.3 : 0.5,
          particleSize: isMobile ? 2 : 3,
          connectionDistance: isMobile ? 80 : 120,
          maxConnections: isLowPerformance ? 2 : 3,
          fps: isLowPerformance ? 30 : 60,
        };

        let lastTime = 0;
        const frameInterval = 1000 / config.fps;

        // Redimensionar canvas
        function resizeCanvas() {
          const rect = canvas.parentElement.getBoundingClientRect();
          canvas.width = rect.width;
          canvas.height = rect.height;
        }

        // Clase Particle optimizada
        class Particle {
          constructor() {
            this.reset();
          }

          reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * config.particleSpeed;
            this.vy = (Math.random() - 0.5) * config.particleSpeed;
            this.size = config.particleSize;
            this.opacity = Math.random() * 0.5 + 0.3;
            this.connections = 0;
          }

          update() {
            this.x += this.vx;
            this.y += this.vy;

            // Rebotar en los bordes
            if (this.x < 0 || this.x > canvas.width) {
              this.vx *= -1;
              this.x = Math.max(0, Math.min(canvas.width, this.x));
            }
            if (this.y < 0 || this.y > canvas.height) {
              this.vy *= -1;
              this.y = Math.max(0, Math.min(canvas.height, this.y));
            }

            this.connections = 0;
          }

          draw() {
            ctx.fillStyle = `rgba(6, 182, 212, ${this.opacity})`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
          }
        }

        // Inicializar partículas
        function initParticles() {
          particles = [];
          for (let i = 0; i < config.particleCount; i++) {
            particles.push(new Particle());
          }
        }

        // Dibujar conexiones optimizado
        function drawConnections() {
          for (let i = 0; i < particles.length; i++) {
            const p1 = particles[i];

            if (p1.connections >= config.maxConnections) continue;

            for (let j = i + 1; j < particles.length; j++) {
              const p2 = particles[j];

              if (p2.connections >= config.maxConnections) continue;

              const dx = p1.x - p2.x;
              const dy = p1.y - p2.y;
              const distance = Math.sqrt(dx * dx + dy * dy);

              if (distance < config.connectionDistance) {
                const opacity =
                  (1 - distance / config.connectionDistance) * 0.3;
                ctx.strokeStyle = `rgba(6, 182, 212, ${opacity})`;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();

                p1.connections++;
                p2.connections++;
              }
            }
          }
        }

        // Loop de animación con control de FPS
        function animate(currentTime) {
          if (isReducedMotion) return;

          animationFrame = requestAnimationFrame(animate);

          const deltaTime = currentTime - lastTime;
          if (deltaTime < frameInterval) return;

          lastTime = currentTime - (deltaTime % frameInterval);

          // Limpiar canvas
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // Actualizar y dibujar partículas
          for (let i = 0; i < particles.length; i++) {
            particles[i].update();
            particles[i].draw();
          }

          // Dibujar conexiones
          drawConnections();
        }

        // Observer para pausar cuando no es visible
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                if (!animationFrame && !isReducedMotion) {
                  animate(performance.now());
                }
              } else {
                if (animationFrame) {
                  cancelAnimationFrame(animationFrame);
                  animationFrame = null;
                }
              }
            });
          },
          { threshold: 0.1 }
        );

        // Inicializar
        resizeCanvas();
        initParticles();

        if (!isReducedMotion) {
          animate(performance.now());
        }

        observer.observe(canvas);

        // Redimensionar con debounce
        let resizeTimeout;
        window.addEventListener("resize", () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            resizeCanvas();
            initParticles();
          }, 250);
        });

        // Limpiar al salir
        window.addEventListener("beforeunload", () => {
          if (animationFrame) {
            cancelAnimationFrame(animationFrame);
          }
          observer.disconnect();
        });
      })();
    </script>
  </body>
</html>
